<!doctype html>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.0.min.js" integrity="sha256-RTQy8VOmNlT6b2PIRur37p6JEBZUE7o8wPgMvu18MC4=" crossorigin="anonymous"></script>
    
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Who's This?</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="cover.css" rel="stylesheet">
    
    <script>
    window.onload = function() {
        getMemberImageRef();
    }
    function getMemberImageRef() {
         $.ajax({
            headers:  {
              'Accept': 'application/json',
              'Content-Type': 'application/json',
            },
            url: 'https://cors-anywhere.herokuapp.com/https://api.parliament.uk/Live/fixed-query/person_photo_index?format=application%2Fjson',
            dataType: 'JSON',
            type: 'GET',
            success: function (data) {
                var m = Math.floor(Math.random() * (data.results.bindings.length));
                var imageId = data.results.bindings[m].image.value;
                var imageId = imageId.replace('https://id.parliament.uk/','');
                var imageURL = 'https://api.parliament.uk/Live/photo/'+imageId+'.jpeg?crop=CU_1:1&width=186&quality=80';
                document.getElementById("image").src = imageURL;
                console.log('You\'ve requested the image for: '+data.results.bindings[m].displayAs.value);
                correctAnswer = Math.floor(Math.random() * 4);
                document.getElementById("name"+correctAnswer).innerHTML = data.results.bindings[m].displayAs.value;
                document.getElementById("correctAnswer").value = correctAnswer;
                for(i=0; i<4; i++){
                    if(i !== correctAnswer){
                        document.getElementById("name"+i).innerHTML = data.results.bindings[Math.floor(Math.random() * (data.results.bindings.length))].displayAs.value;
                    }
                }                
            }
        });
    }
    function checkanswer(answer) {
        var correctAnswer =  document.getElementById("correctAnswer").value;
        if(answer == correctAnswer){
            var correctElement = document.getElementById("name"+correctAnswer);
            correctElement.classList.add("btn-success");
            correctElement.classList.remove("btn-secondary");
            setTimeout(function(){
                getMemberImageRef();
                correctElement.classList.add("btn-secondary");
                correctElement.classList.remove("btn-success");
                $('.btn-danger').addClass('btn-secondary');
                $('.btn-danger').removeClass('btn-danger');
            }, 2000);
        } else {
            var incorrectElement = document.getElementById("name"+answer);
            incorrectElement.classList.add("btn-danger");
            incorrectElement.classList.remove("btn-secondary");
        }
    }
    </script>
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <header class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">Who's this?</h3>
              <nav class="nav nav-masthead">
                <a class="nav-link active" href="#">Easy</a>
                <a class="nav-link" href="#">Medium</a>
                <a class="nav-link" href="#">Hard</a>
              </nav>
            </div>
          </header>

          <main role="main" class="inner cover">
           <!-- <h1 class="cover-heading">Who's this then?</h1> -->
            <p class="lead">
                <img id="image" alt="Image" src="images/blankface.png">
                <input id="correctAnswer" type="hidden" value="0">
            </p>
            <div class="row">
                <div class="col">
                    <a id="name0" href="#" onclick="checkanswer(0)" class="btn btn-lg btn-secondary"></a>
                </div>
                <div class="col">
                    <a id="name1" href="#" onclick="checkanswer(1)" class="btn btn-lg btn-secondary"></a>
                </div>
                <div class="col">
                    <a id="name2" href="#" onclick="checkanswer(2)" class="btn btn-lg btn-secondary"></a>
                </div>
                <div class="col">
                    <a id="name3" href="#" onclick="checkanswer(3)" class="btn btn-lg btn-secondary"></a>
                </div>
            </div>
          </main>

          <footer class="mastfoot">
            <div class="inner">
              <p>Created by <a href="http://twitter.com/danleedham">Dan Leedham</a></p>
            </div>
          </footer>

        </div>

      </div>

    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="popper.min.js"></script>
    <script src="bootstrap.min.js"></script>
  </body>
</html>
